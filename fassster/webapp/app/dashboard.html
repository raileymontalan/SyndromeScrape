
<div class="main-content"  id="dashboardpage">
    <div class="content" style="text-align: center;">
        <div class="row">
            <div class="col-md-6">
                <div class="card red">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="title">
                                STEM Projects
                            </div>
                        </div>
                    </div>
                    <div class="card-body clearfix">
                        <div class="col-md-4 border-right">
                            <p><span class="summaryTotal" id="allTotal">-</span><br>
                            All Projects</p>
                        </div>
                        <div class="col-md-4 border-right">
                            <p><span class="summaryTotal" id="myTotal">-</span><br>
                            My Uploads</p>
                        </div>
                        <div class="col-md-4">
                            <p><span class="summaryTotal" id="shareTotal">-</span><br>
                            Shared to me</p>
                        </div>
                        <br clear="all" />&nbsp;
                        <div class="col-md-12 topGroup">
                            <p class="movtop"><strong>Top 4 Projects by Disease</strong> | <small>Past 24 months</small></p>
                            <div class="col-md-3">
                                <p class="topTotal" id="dengueNum">-</p>
                                <p class="topLabel">Dengue</p>
                            </div>
                            <div class="col-md-3">
                                <p class="topTotal" id="typhoidNum">-</p>
                                <p class="topLabel">Typhoid</p>
                            </div>
                            <div class="col-md-3">
                                <p class="topTotal" id="measlesNum">-</p>
                                <p class="topLabel">Measles</p>
                            </div>
                            <div class="col-md-3">
                                <p class="topTotal" id="othersNum">-</p>
                                <p class="topLabel">Others</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 col-sm-12">
                <div class="card green">
                    <div class="card-header no-border">
                        <div class="card-title">
                            <div class="title">News Stats</div>
                            <div class="stitle">&nbsp;</div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="piechart">
                            <div id="newsChart" class="chart-circle" data-percent=""></div>
                        </div>

                        <div class="footer">
                            <hr>
                            <div class="stats">
                                <i class="ti-timer"></i> Past 7 days
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-12">
                <div class="card blue">
                    <div class="card-header no-border">
                        <div class="card-title">
                            <div class="title">Tweets Stats</div>
                            <div class="stitle">&nbsp;</div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="piechart">
                            <div id="tweetsChart" class="chart-circle" data-percent=""></div>
                        </div>

                        <div class="footer">
                            <hr>
                            <div class="stats">
                                <i class="ti-timer"></i> Past 7 days
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row charting">
            <div class="col-sm-12 col-xs-12">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="title">Disease Historical Trend</div>
                        </div>
                        <div class="card-info">
                            <p id="diseaseLabel" class="graphLabel">ZARRAGA, ILOILO &bull; 2017 &bull; EMR</p>
                        </div>
                        <div class="dropdown pull-right">
                            <button type="button" class="btn btn-success sourcer" data-toggle="popover-disease" data-trigger="focus" data-placement="bottom">Source Options</button>
                        </div>
                    </div>
                    <div class="card-body no-padding">
                        <div id="diseasediv"><i class="fa fa-sync fa-spin fa-3x fa-fw margintop100"></i></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row charting">
            <div class="col-sm-12 col-xs-12">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="title">Syndromic Historical Trend</div>
                        </div>
                        <div class="card-info">
                            <p id="syndromicLabel" class="graphLabel">ZARRAGA, ILOILO &bull; 2017 &bull; Fever, Cough</p>
                        </div>
                        <div class="dropdown pull-right">
                            <button type="button" class="btn btn-success sourcer" data-toggle="popover-syndromic" data-trigger="focus" data-placement="bottom">Source Options</button>
                        </div>
                    </div>
                    <div class="card-body no-padding">
                        <div id="syndromicdiv"><i class="fa fa-sync fa-spin fa-3x fa-fw margintop100"></i></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row charting">
            <div class="col-sm-12 col-xs-12">
                <div class="card dark">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="title">STEM Forecast Trend</div>
                        </div>
                        <div class="card-info">
                            <p id="forecastLabel" class="graphLabel">ZARRAGA, ILOILO &bull; STEM Project &bull; Scenario</p>
                        </div>
                        <div class="dropdown pull-right">
                            <button type="button" class="btn btn-success sourcer" data-toggle="popover-forecast" data-trigger="focus" data-placement="bottom">Source Options</button>
                        </div>
                    </div>
                    <div class="card-body no-padding">
                        <div id="forecastdiv"><i class="fa fa-sync fa-spin fa-3x fa-fw margintop100"></i></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="popup-disease hidden">
    <div class="row">
        <div class="form-group">
            <label class="col-md-12">Location</label>
            <div class="col-md-12">
                <select class="form-control input-sm" name="diseaseregion" id="diseaseregion">
                    <option value="06">Region VI</option>
                </select>
                <select class="form-control input-sm" name="diseaseprovince" id="diseaseprovince" onchange="storeValue('disease','province',this); updateCits('disease',this.value);">
                    <option value="" disabled="disabled" selected>Choose Province</option>
                </select>
                <select class="form-control input-sm" name="diseasecitymun" id="diseasecitymun" onchange="storeValue('disease','city',this)">
                    <option value="" disabled="disabled" selected>Choose Municipality/City</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-12">Disease</label>
            <div class="col-md-12">
            <select class="form-control input-sm" name="disease" id="disease" onchange="storeValue('disease','',this)">
                <option disabled="disabled" selected>Choose disease</option>
                <option>Dengue</option>
                <option>Typhoid</option>
                <option>Measles</option>
            </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-12">Year</label>
            <div class="col-md-12">
            <select class="form-control input-sm" name="diseaseyear" id="diseaseyear" onchange="storeValue('disease','year',this)">
                <option disabled="disabled" selected>Choose year</option>
                <option>2012</option>
                <option>2013</option>
                <option>2014</option>
                <option>2015</option>
                <option>2016</option>
                <option>2017</option>
            </select>
            </div>
        </div>
        <hr class="hrlow" />
        <div class="form-group pull-right no-margin-bottom">
            <div class="col-md-12">
                <button class="btn btn-default" onclick="updateChart('disease')">Submit</button>
                <button class="btn btn-warning" onclick="$('[data-toggle=popover-disease]').popover('hide');">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="popup-syndromic hidden">
    <div class="row">
        <div class="form-group">
            <label class="col-md-12">Location</label>
            <div class="col-md-12">
                <select class="form-control input-sm" id="syndromicregion">
                    <option value="06">Region VI</option>
                </select>
                <select class="form-control input-sm" id="syndromicprovince" onchange="storeValue('syndromic','province',this); updateCits('syndromic',this.value)">
                    <option value="" disabled="disabled" selected>Choose Province</option>
                </select>
                <select class="form-control input-sm" id="syndromiccitymun" onchange="storeValue('syndromic','city',this)">
                    <option value="" disabled="disabled" selected>Choose Municipality/City</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-12">Symptoms (<small>Multiple</small>)</label>
            <div class="col-md-12">
            <select multiple class="form-control input-sm" name="syndromic" id="syndromic" onchange="storeValue('syndromic','',this)">
                <option data-template="data-template" data-from-map value="{{ . }}">{{ . }}</option>
            </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-12">Year</label>
            <div class="col-md-12">
            <select class="form-control input-sm" id="syndromicyear" onchange="storeValue('syndromic','year',this)">
                <option disabled="disabled" selected>Choose year</option>
                <option>2013</option>
                <option>2014</option>
                <option>2015</option>
                <option>2016</option>
                <option>2017</option>
            </select>
            </div>
        </div>
        
        <div class="form-group pull-right no-margin-bottom">
            <div class="col-md-12">
                <button type="submit" class="btn btn-default" onclick="updateChart('syndromic')">Submit</button>
                <button class="btn btn-warning" onclick="$('[data-toggle=popover-syndromic]').popover('hide');">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="popup-forecast hidden">
    <div class="row">
        <div class="form-group">
            <label class="col-md-12">Location</label>
            <div class="col-md-12">
                <select class="form-control input-sm" id="forecastregion" onchange="storeValue('forecast','region',this)">
                    <option value="06">Region VI</option>
                </select>
                <select class="form-control input-sm" id="forecastprovince" onchange="storeValue('forecast','province',this); updateCits('forecast',this.value, 'bynames')">
                    <option value="" disabled="disabled" selected>Choose Province</option>
                </select>
                <select class="form-control input-sm" id="forecastcitymun" onchange="storeValue('forecast','city',this)">
                    <option value="" disabled="disabled" selected>Choose Municipality/City</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-12">STEM Project</label>
            <div class="col-md-12">
            <select class="form-control input-sm" name="project" id="projectSelect" onchange="storeValue('forecast','stem',this); updateScenarioList(this.value)">
                <option data-template="data-template" data-from-map value="{{ id }}">{{ title }}</option>
            </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-12">Project Scenario</label>
            <div class="col-md-12">
            <select class="form-control input-sm" name="scenario" id="scenarioSelect" onchange="storeValue('forecast','scenario',this);">
                <option value="">Choose a project first</option>
            </select>
            </div>
        </div>
        
        <div class="form-group pull-right no-margin-bottom">
            <div class="col-md-12">
                <button type="submit" class="btn btn-default" onclick="updateChart('forecast')">Submit</button>
                <button class="btn btn-warning" onclick="$('[data-toggle=popover-forecast]').popover('hide');">Cancel</button>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="assets/plugins/amcharts3/plugins/export/export.css" type="text/css" media="all" />
<script src="assets/plugins/amcharts3/amcharts.js"></script>
<script src="assets/plugins/amcharts3/serial.js"></script>
<script src="assets/plugins/amcharts3/plugins/export/export.min.js"></script>
<script src="assets/plugins/amcharts3/themes/light.js"></script>
<script type="text/javascript" src="assets/plugins/jquery.easy-pie-chart.js"></script>
<script type="text/javascript" src="assets/js/dashboard.js"></script>
<script type="text/javascript">
$(document).ready(function() {
    //let us check if user is logged in
    if(!checkAuth()) {
		//if not logged in - redirect to login page
		location.href='app/login.html';
	}

      $('[data-toggle="popover-disease"]').popover({
        html: true,
        title : 'Source Options<button type="button" class="close" onclick="$(&quot;[data-toggle=popover-disease]&quot;).popover(&quot;hide&quot;);">&times;</button>',
        trigger: 'manual',
        content: function () {
            $('select#diseaseprovince').empty();
            $('select#diseaseprovince').append("<option value='' disabled selected>Choose Province</option>");
            $('select#diseasecitymun').empty();
            $('select#diseasecitymun').append("<option value='' disabled selected>Choose Municipality/City</option>");
            //customized popup contents
            $.getJSON( "assets/geojson/lov_citymun.json", function( data ) {
                var provs = [];
                var cits = [];
                $.each( data.provinces, function( key, val ) {
                    provs.push( "<option value='" + val.province_code + "'>" + val.province_name + "</option>" );
                });
                $('select#diseaseprovince').append(provs.join(""));
            });
            return $('.popup-disease').html();
        }
      }).click(function(e) {
          $(this).popover('toggle');
          $('.popup-window').not(this).popover('hide');

          e.stopPropagation();
      });

      $('[data-toggle="popover-syndromic"]').popover({
          html: true,
          title : 'Source Options<button type="button" class="close" onclick="$(&quot;[data-toggle=popover-syndromic]&quot;).popover(&quot;hide&quot;);">&times;</button>',
          trigger: 'manual',
          content: function () {
              $('select#syndromicprovince').empty();
              $('select#syndromicprovince').append("<option value='' disabled selected>Choose Province</option>");
              $('select#syndromiccitymun').empty();
              $('select#syndromiccitymun').append("<option value='' disabled selected>Choose Municipality/City</option>");
              //customized popup contents
              $.getJSON( "assets/geojson/lov_citymun.json", function( data ) {
                  var provs = [];
                  var cits = [];
                  $.each( data.provinces, function( key, val ) {
                      provs.push( "<option value='" + val.province_code + "'>" + val.province_name + "</option>" );
                  });
                  $('select#syndromicprovince').append(provs.join(""));
              });
              return $('.popup-syndromic').html();
          }
      }).click(function(e) {
          $(this).popover('toggle');
          $('.popup-window').not(this).popover('hide');

          e.stopPropagation();
      });

      $('[data-toggle="popover-forecast"]').popover({
          html: true,
          title : 'Source Options<button type="button" class="close" onclick="$(&quot;[data-toggle=popover-forecast]&quot;).popover(&quot;hide&quot;);">&times;</button>',
          trigger: 'manual',
          content: function () {
              $('select#forecastprovince').empty();
              $('select#forecastprovince').append("<option value='' disabled selected>Choose Province</option>");
              $('select#forecastcitymun').empty();
              $('select#forecastcitymun').append("<option value='' disabled selected>Choose Municipality/City</option>");
              //customized popup contents
              $.getJSON( "assets/geojson/lov_citymun.json", function( data ) {
                  var provs = [];
                  var cits = [];
                  $.each( data.provinces, function( key, val ) {
                      //provs.push( "<option value='" + val.province_code + "'>" + val.province_name + "</option>" );
                      //using names
                      provs.push( "<option value='" + val.province_name.replace(/[.()\ -]/g,"").toLowerCase() + "'>" + val.province_name + "</option>" );
                  });
                  $('select#forecastprovince').append(provs.join(""));
              });
              return $('.popup-forecast').html();
          }
      }).click(function(e) {
          $(this).popover('toggle');
          $('.popup-window').not(this).popover('hide');

          e.stopPropagation();
      });

    //let us check token
    token = checkToken( $.session.get('userToken') );
    //let us get symptoms list
    var symptoms = [];
    var body = {};
    $.post("http://www.romeljohnsantos.com/api/projects.php?type=symptoms",
        body, function(data) {
            if(data) {
                symptoms= data;
            }
        }, "json")
    .done(function() {
        //console.log("Symptoms list", symptoms);
        //render data to template
        Tempo.prepare("syndromic").render(symptoms);
    });

    //let us get projects list
    var projects = [{ id:"", title:"Choose a STEM Project" }];
    var body = {};
    $.ajax({
        url: "http://104.236.3.75/fassster-api/public/api/projects/get",
        data: body, 
        type: "get",
        dataType: "json",
        headers: { 
                "Authorization": "Bearer " + token
            },
        success: function(data, textStatus, jqXHR){
                //console.log('OK! Project loaded.');
            }
        })
        .done(function(data) {
            //console.log("all projects", data);
            if(data && data.success == true) {
                $.each(data.data, function(i, item) {
                    projects.push({
                        id: i,
                        title: item
                    });
                });
                //console.log("Projects loaded:", projects);
                //display data using template plugin
                Tempo.prepare("projectSelect").render(projects);
            }
    });

      getCounts();
      getSummary('news', 'newsChart');
      getSummary('tweets', 'tweetsChart');
      //Disease Historical Graph
      getData("disease", ["shine","iclinicsys"], ["dengue"], "and", "01-12", "2016", "city","063046");
      //Syndromic Historical Graph
      getData("syndromic",  ["shine","iclinicsys"], [ "fever", "cough" ], "and", "01-12", "2016", "city", "063046");
      //STEM Forecast Graph
      getStemForecast("111", "6", "negrosoccidental", "bacolodcity");

      $('.preloader').hide();
});
</script>