<div class="main-content"  id="dashboardpage">
    <div class="content" style="text-align: center;">
        <div class="row charting">
            <div class="col-sm-12 col-xs-12">
                <div class="card dark">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="title">Forecast Predictions</div>
                        </div>
                        <div class="card-info">
                            <small id="forecastLabel">ZARRAGA, ILOILO &bull; STEM Project &bull; Scenario</small>
                        </div>
                        <div class="dropdown pull-right">
                            <button type="button" class="btn btn-success sourcer" data-toggle="popover-forecast" data-container="body" data-placement="bottom">Source Options</button>
                        </div>
                    </div>
                    <div class="card-body no-padding">
                        <div id="analyticsforecastdiv"><i class="fa fa-refresh fa-spin fa-3x fa-fw margintop100"></i></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="popup-forecast hidden">
    <div class="row">
        <div class="form-group">
            <label class="col-md-12">Location</label>
            <div class="col-md-12">
                <select class="form-control input-sm" id="forecastregion">
                    <option value="06">Region VI</option>
                </select>
                <select class="form-control input-sm" id="forecastprovince" onchange="storeValue('forecast','province',this); updateCits('forecast',this.value)">
                    <option value="" disabled="disabled" selected>Choose Province</option>
                </select>
                <select class="form-control input-sm" id="forecastcitymun" onchange="storeValue('forecast','city',this)">
                    <option value="" disabled="disabled" selected>Choose Municipality/City</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-12">STEM Project</label>
            <div class="col-md-12">
            <select class="form-control input-sm" name="project" id="projectSelect" onchange="storeValue('forecast','year',this); updateScenario(this.value)">
                <option disabled="disabled" selected>Choose Project</option>
            </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-12">Project Scenario</label>
            <div class="col-md-12">
            <select class="form-control input-sm" name="scenario" id="scenarioSelect" onchange="storeValue('forecast','',this)">
                <option disabled="disabled" selected>Choose Scenario</option>
            </select>
            </div>
        </div>
        
        <div class="form-group pull-right no-margin-bottom">
            <div class="col-md-12">
                <button type="submit" class="btn btn-default" onclick="updateChart('forecast')">Submit</button>
                <button class="btn btn-warning" onclick="$('[data-toggle=popover-forecast]').popover('hide');">Cancel</button>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="assets/plugins/amcharts3/plugins/export/export.css" type="text/css" media="all" />
<script src="assets/plugins/amcharts3/amcharts.js"></script>
<script src="assets/plugins/amcharts3/serial.js"></script>
<script src="assets/plugins/amcharts3/plugins/export/export.min.js"></script>
<script src="assets/plugins/amcharts3/themes/light.js"></script>
<script type="text/javascript">
$(document).ready(function() {

      $('[data-toggle="popover-forecast"]').popover({
          html: true,
          title : 'Source Options<button type="button" class="close" onclick="$(&quot;[data-toggle=popover-forecast]&quot;).popover(&quot;hide&quot;);">&times;</button>',
          trigger: 'manual',
          content: function () {
              $('select#forecastprovince').empty();
              $('select#forecastprovince').append("<option value='' disabled selected>Choose Province</option>");
              $('select#forecastcitymun').empty();
              $('select#forecastcitymun').append("<option value='' disabled selected>Choose Municipality/City</option>");
              //customized popup contents
              $.getJSON( "assets/geojson/lov_citymun.json", function( data ) {
                  var provs = [];
                  var cits = [];
                  $.each( data.provinces, function( key, val ) {
                      provs.push( "<option value='" + val.province_code + "'>" + val.province_name + "</option>" );
                  });
                  $('select#forecastprovince').append(provs.join(""));
              });
              return $('.popup-forecast').html();
          }
      }).click(function(e) {
          $(this).popover('toggle');
          $('.popup-window').not(this).popover('hide');

          e.stopPropagation();
      });
      
      getData("analyticsforecast");

      $('.preloader').hide();
});

function getData(myfilter,mysymptoms,myyear,mygeocode) {
  var body = {
      filter: myfilter,
      symptoms: mysymptoms,
      year: myyear,
      geocode: mygeocode
  }
  cData = [];
  //var promise = $.post("http://fassster.ehealth.ph/web_api/emr",
  var promise = $.post("http://www.romeljohnsantos.com/api/forecast.php?id=all",
   body, function(data) {
        if(data) {
            cData = data;
        }
    }, "json");

  promise.done(function() {
        console.log(cData);
        forecastChart(cData);
        cData = [];
  });
}

function forecastChart(dataResponse) {
    var schart = AmCharts.makeChart("analyticsforecastdiv", {
      "type": "serial",
      "theme": "none",
      "marginRight": 65,
      "autoMarginOffset": 20,
      "marginTop": 7,
      "dataProvider": dataResponse,
      "mouseWheelZoomEnabled": false,
      "legend": {
          "useGraphSettings": true,
          "color": "#FFFFFF"
      },
      "valueAxes": [{
        "id":"v1",
        "axisColor": "#DDDDDD",
        "color": "#BBBBBB",
        "axisThickness": 2,
        "axisAlpha": 1,
        "position": "left",
        "gridColor": "#BBBBBB",
      }],
      "graphs": [{
          "valueAxis": "v1",
          "lineColor": "#FF6600",
          "bullet": "round",
          "bulletBorderThickness": 1,
          "hideBulletsCount": 30,
          "title": "Count",
          "valueField": "count",
          "fillAlphas": 0,
          "lineThickness": 2,
          //"type": "smoothedLine",
      },{
          "valueAxis": "v2",
          "lineColor": "#ffefb0",
          "bullet": "round",
          "bulletBorderAlpha": 1,
          "bulletBorderThickness": 2,
          "useLineColorForBulletBorder": true,
          "hideBulletsCount": 30,
          "title": "Prediction",
          "valueField": "count_pred",
          "fillAlphas": 0,
          "lineThickness": 1,
          //"type": "smoothedLine",
      }],
      "chartScrollbar": {
          "autoGridCount": true,
          "graph": "g1",
          "color": "#000000",
          "backgroundAlpha": 1,
          "backgroundColor": "#999999",
          "gridColor": "#999999",
          "selectedBackgroundColor": "#CCCCCC",
          "scrollbarHeight": 30
      },
      "chartCursor": {
        "limitToGraph":"g1"
      },
      "categoryField": "date",
      "categoryAxis": {
          "parseDates": true,
          "axisColor": "#888888",
          "color": "#BBBBBB",
          "dashLength": 1,
          "minorGridEnabled": true,
          "gridColor": "#BBBBBB",
      },
      "export": {
          "enabled": true
      }
    });
}
</script>